<router-outlet></router-outlet>
<p-toast></p-toast>
<div class="flex justify-content-center mt-4">
  <form [formGroup]="formGroup" id="registerForm" class="flex flex-column gap-4 w-50rem">
    <h1>Perfil</h1>

    <div class="inline-flex flex-column gap-4">

      <div class="inline-flex gap-3">
        <div>
            <span class="p-input-filled">
              <input id="name" formControlName="name" type="text" pInputText placeholder="Nombre"
                     class="p-3 border-round-3xl border-0 bg-gray-200">
            </span>
          @if (formGroup.controls['name'].invalid && formGroup.controls['name'].touched) {
            <p *ngIf="formGroup.controls['name'].errors?.required" class="text-red-500 text-xs m-0 ml-3">
              El nombre es obligatorio</p>
            <p *ngIf="formGroup.controls['name'].errors?.minlength" class="text-red-500 text-xs m-0 ml-3">
              El nombre debe tener al menos 3 caracteres</p>
            <p *ngIf="formGroup.controls['name'].errors?.maxlength" class="text-red-500 text-xs m-0 ml-3">
              El nombre debe tener como máximo 50 caracteres</p>
          }
        </div>
        <div>
            <span class="p-input-filled">
              <input id="email" formControlName="email" type="text" pInputText placeholder="Email"
                     class="p-3 border-round-3xl border-0 bg-gray-200">
            </span>
          @if (formGroup.controls['email'].invalid && formGroup.controls['email'].touched) {
            <p *ngIf="formGroup.controls['email'].errors?.required" class="text-red-500 text-xs m-0 ml-3">
              El email es obligatorio</p>
            <p *ngIf="formGroup.controls['email'].errors?.email" class="text-red-500 text-xs m-0 ml-3">
              El email no es válido</p>
          }
        </div>
      </div>

      <div class="inline-flex gap-3">
        <div><span class="p-input-filled">
            <input id="username" formControlName="username" type="text" pInputText placeholder="Username"
                   class="p-3 border-round-3xl border-0 bg-gray-200">
          </span>
          @if (formGroup.controls['username'].invalid && formGroup.controls['username'].touched) {
            <p *ngIf="formGroup.controls['username'].errors?.required" class="text-red-500 text-xs m-0 ml-3">
              El username es obligatorio</p>
            <p *ngIf="formGroup.controls['username'].errors?.minlength" class="text-red-500 text-xs m-0 ml-3">
              El username debe tener al menos 3 caracteres</p>
            <p *ngIf="formGroup.controls['username'].errors?.maxlength" class="text-red-500 text-xs m-0 ml-3">
              El username debe tener como máximo 50 caracteres</p>
          }</div>

        <div><span class="p-input-filled">
            <input id="dni" formControlName="dni" type="text" pInputText placeholder="DNI" (input)="validateDNI($event)"
                   class="p-3 border-round-3xl border-0 bg-gray-200">
          </span>
          @if (formGroup.controls['dni'].invalid && formGroup.controls['dni'].touched) {
            <p *ngIf="formGroup.controls['dni'].errors?.required" class="text-red-500 text-xs m-0 ml-3">
              El DNI es obligatorio</p>
            <p *ngIf="formGroup.controls['dni'].errors?.minlength" class="text-red-500 text-xs m-0 ml-3">
              El DNI debe tener 9 caracteres</p>
            <p *ngIf="formGroup.controls['dni'].errors?.maxlength" class="text-red-500 text-xs m-0 ml-3">
              El DNI debe tener 9 caracteres</p>
            <p *ngIf="formGroup.controls['dni'].errors?.incorrect" class="text-red-500 text-xs m-0 ml-3">
              El DNI no es correcto</p>
          }</div>
      </div>

      <div class="inline-flex gap-3">
        <div>
            <span class="p-input-filled">
          <input id="phone" formControlName="phone" type="text" pInputText placeholder="Teléfono"
                 class="p-3 border-round-3xl border-0 bg-gray-200" (keyup.enter)="sendForm()">
        </span>
          @if (formGroup.controls['phone'].invalid && formGroup.controls['phone'].touched) {
            <p *ngIf="formGroup.controls['phone'].errors?.required" class="text-red-500 text-xs m-0 ml-3">
              El teléfono es obligatorio</p>
            <p *ngIf="formGroup.controls['phone'].errors?.minlength" class="text-red-500 text-xs m-0 ml-3">
              El teléfono debe tener 9 caracteres</p>
            <p *ngIf="formGroup.controls['phone'].errors?.maxlength" class="text-red-500 text-xs m-0 ml-3">
              El teléfono debe tener 9 caracteres</p>
          }
        </div>

        <div>
          <p-dropdown formControlName="gender" [options]="genders" placeholder="Selecciona un género"
                      styleClass="w-16rem"/>
          @if (formGroup.controls['gender'].invalid && formGroup.controls['gender'].touched) {
            <p *ngIf="formGroup.controls['gender'].errors?.required" class="text-red-500 text-xs m-0 ml-3">
              El género es obligatorio</p>
          }
        </div>
      </div>

      <div class="inline-flex gap-3">
        <div>
            <span class="p-input-filled">
          <input pPassword id="password" formControlName="password" type="password" pInputText placeholder="Contraseña"
                 class="p-3 border-round-3xl border-0 bg-gray-200" (keyup.enter)="sendForm()">
        </span>
          @if (formGroup.controls['password'].invalid && formGroup.controls['password'].touched) {
            <p *ngIf="formGroup.controls['password'].errors?.required" class="text-red-500 text-xs m-0 ml-3">
              La contraseña es obligatoria</p>
            <p *ngIf="formGroup.controls['password'].errors?.minlength" class="text-red-500 text-xs m-0 ml-3">
              La contraseña debe tener al menos 3 caracteres</p>
            <p *ngIf="formGroup.controls['password'].errors?.maxlength" class="text-red-500 text-xs m-0 ml-3">
              La contraseña debe tener como máximo 50 caracteres</p>
          }
        </div>

        <div>
            <span class="p-input-filled">
          <input pPassword id="confirmpassword" formControlName="confirmpassword" type="password" pInputText
                 placeholder="Confirmar contraseña"
                 class="p-3 border-round-3xl border-0 bg-gray-200" (keyup.enter)="sendForm()">
        </span>
          @if (formGroup.errors?.passwordMismatch && formGroup.controls['confirmpassword'].touched) {
            <p class="text-red-500 text-xs m-0 ml-3">
              Las contraseñas no coinciden
            </p>
          }
        </div>
      </div>
    </div>
  </form>

  <div class="flex flex-column justify-content-center m-8">
    <img [src]="avatar" alt="User avatar" class="rounded-full w-14rem h-14rem border-round-lg"
         style="object-fit: cover"/>

    <p-splitButton icon="pi pi-camera" (onClick)="up.toggle($event)" [model]="items" pTooltip="Subir avatar"
                   [showDelay]="500" [style]="{backgroundColor: 'black', width: '14rem'}" [autoHide]="true"
                   tooltipPosition="bottom" styleClass="w-full mt-2" rounded>
    </p-splitButton>

    <p-overlayPanel #up>
      <div class="flex justify-content-center">
        <p-fileUpload name="avatar" url="http://localhost:5196/index/avatar" accept="image/*" [multiple]="false"
                      (onUpload)="onUpload()" chooseLabel="Elegir" uploadLabel="Enviar" cancelLabel="Cancelar"
                      method="put" invalidFileTypeMessageDetail="Solo se permiten imágenes"
                      [chooseStyleClass]="'bg-black-alpha-90 border-transparent hover:bg-black-alpha-70'"
                      [uploadStyleClass]="'bg-black-alpha-90 border-transparent hover:bg-black-alpha-70'"
                      [cancelStyleClass]="'bg-black-alpha-90 border-transparent hover:bg-black-alpha-70'">
          <ng-template pTemplate="content">
            <div class="flex flex-column align-items-center gap-2">
              <i class="pi pi-upload text-5xl"></i>
              <span class="text-lg">Arrastra y suelta una imagen aquí</span>
            </div>
          </ng-template>
        </p-fileUpload>
      </div>
    </p-overlayPanel>
  </div>
</div>

<div class="mt-4 w-full">
  <div class="flex align-items-center justify-content-center w-full">
    <p-button label="Guardar cambios" (click)="sendForm()" [rounded]="true" styleClass="bg-black-alpha-90 border-transparent hover:bg-black-alpha-70"/>
  </div>
  <div class="flex align-items-center justify-content-center mt-2">
    <p-button label="Volver" (click)="goBack()" severity="secondary" [rounded]="true" [text]="true"/>
  </div>
</div>
